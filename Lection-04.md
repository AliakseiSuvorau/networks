# Лекция 4

## Содержание

* [ARP](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-04.md#arp-address-resolution-protocol)
* [Сервисы канального уровня](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-04.md#сервисы-канального-уровня)
* [VLAN](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-04.md#vlan)

### Проблемы передачи большого количества данных

* Устройства могут быть перегружены. В таком случае данные, не помещающиеся в очередь, будут отброшены
* Решение: устройства могут сообщать соседям о перегруженности (т.е. отправить сообщение с просьбой приостановить посылку или посылать посредством mac control кадра)
* Реализация механизма mac control кадра - pause-кадр
* Адрес соседа (Destination address, DA): `01-80-c2-00-00-01`
* Минус:
  * Нет отбора трафика, если останавливаем трафик - сразу весь
* Решение: разобьем протоколы на группы по важности и приостанавливаем трафик из определенной группы

> [!NOTE]
> Есть механизм автосогласования параметров электрически не совместимых устройств для избежания ситуаций, когда одно устройство передает заведомо больше, чем другое может принять

### ARP (Address resolution protocol) 

* По адресам сетевого уровня позволяет получить адреса канального уровня
* В IPv6 ARP не используется. Его замена - протокол NDP, Neightbours Detect Protocol
* Gratuitous ARP - запрос о том, есть ли в сети такой же ip-адрес, как и у нас (так как в одной сети не должно одновременно находиться 2 устройства с одинаковыми ip-адресами)
* Минусы:
  * Нет механизма аутентификации узлов
  * Заполнение таблиц коммутации, переполнение ARP-кэша
* Решение:
  * Ротация таблиц коммутации в виде циклического буфера
  * Ограничение по количеству mac-адресов на порт
  * Отключение неиспользуемых портов коммутатора
  * Статические записи в таблице коммутации и ARP-кэше
  * Аутентификация при подключении к сети

## Сервисы канального уровня

### Типы Ethrnet коммутаторов
* По управляемости:
  * Управляемые
  * Неуправляемые

* По типу поддержки физических параметров:
  * С фиксированной архитектурой
  * С гибкой архитектурой

### Зеркалирование трафика

* Пересылаем копию трафика на другой порт коммутатора

### Фильтрация трафика

* Отключаем неиспользуемые порты
* Ограничение по mac-адресам
* Ограничение на количество пересылаемых кадров определенного типа
* Ограничение на пропускную способность порта

### VLAN

* Стандарт IEEE 802.1Q
  * Вводится понятие VLAN
  * Описываются методы приоритетизации трафика
  * Описываются методы динамического изменения членства в VLAN'ах
  * Описывается новый протокол для автоматической настройки VLAN'ов
  * Описывает разные варианты использования VLAN'ов с другими сервисами уровня

* Делим устройства из одной физической сети на несколько вирутальных сетей (запрещаем сообщения между некоторыми портами)
  
* Создаем тег в заголовке кадра

* Плюсы:
  * Перемещаем устройства без реконфигурации
  * Меняем домен вещания устройства
  * Изолируем части сети

> [!NOTE]
> Добавление тега в заголовок подразумевает дополнительные 32 бита перед частью заголовка, отвечающего за длину/тип сообщения (см. [Лекцию 3](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-03.md#поля-пакета-ethrnet))
> * 16 бит - Tag protocol identifier
> * 16 бит - Tag control information
>   * 3 бита - User priority
>   * 1 бит, который отвечает за то, представлен ли  mac-адрес в каноническом формате
>   * 12 бит - VLAN identifier


> [!NOTE]
> Значения VID:
> * `0x000` - нет информации про VLAN (информация только о приоритетах)
> * `0x001` - стандартный VLAN, использующийся внутри коммутаторов для классификации трафика, который идет на тегированные порты
> * `0x002-0xFFE` - пользовательские VLAN'ы
> * `0xFFF` - зарезервирован на будущее

### Порты

* Нетегированные - не знают о VLAN'ах. Если на них приходят пакеты, то из этих пакетов должна быть удалена информация о VLAN'ах
* Тегированные - трафик снабжается тегом

### Правила работы с тегами

* Каждый порт, кроме зеркального, входит в хотя бы один статический VLAN
* Порт входит как нетегированный в 0 или 1 VLAN
* Порт входит как тегированный в любое число VLAN'ов
* Порт не может быть и тегированным, и не тегированным для одного VLAN'а
