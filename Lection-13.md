# Доп. лекция

## DNS

* Сопоставление символьных имен сетевым адресам
* Построение иерархического адресного пространства
* Создание распределенной инфраструктуры для разрешения символьных имен в сетевые адреса
* Базовые стандарты: RFC 1034 и RFC 1035 (1987 г.)
* Раньше: hosts.txt - маппинг храним в файле (сейчас тоже можно встретить)

### Задачи

* Масштабируемость
  * Поддержка огромного количества имен, в том числе генерируемых автоматически в реальном времени
* Распределенное управление
  * Владельцы имен сами отвечают за их поддержание и модификацию
* Устойчивость к ошибкам
  * Резервирование
  * Кэширование (локальное и на сервере)
  * Обработка ошибок

* В итоге имеем:
  * Load-mostly DB
  * Loose consistency (нам не критично мгновенно обновляться, чтобы иметь актуальные данные)

### Компоненты инфраструктуры

* Пространство доменных имен и ресурсные записи
* Сервера имен
* "Разрешатели" имен (Resolvers)

#### Пространство имен

* Ограничения
  * Стандартные:
    * Использования латинских символов
    * 63 октета на максимальный размер метки
    * 255 октетов на максимальный размер адреса
    * *Пример*: `mipt.ru` - адрес, а `mipt` и `ru` - метки
  * Расширенные:
    * Можно использовать unicode и emoji

* Домены состоят из набора зон
  * Каждый домен делегирует управление следующим поддоменам
  * Каждая зона имеет реплику для надежности
#### Ресурсные записи

Представляют собой информацию, хранящуюся в базе данных DNS и связанную с определенными доменными именами.

#### Сервера имен

Когда хост делает запрос к доменному серверу, то он одидает получить ответ, а не перенаправление на другой сервер. Но сервера между собой могут общаться такими пересылками.

Идем с хоста в локальный DNS-сервер. Он стучится в корневой DNS-сервер, и оттуда начинаем раскручивать метки, пок ане дойдем до нужного адреса или не поймем, что его нет.

#### Разрешатель

* Находится на хосте
* Клиент: либо смотрит кэш, либо делает запрос к внешним серверам
* Сервер: имеет те же компоненты, что и клиент, но resolver ходит не в кэш, а в БД. Таже может обращаться к другим серверам

### Типы взаимодействия клиент-сервер

* Рекурсивыне запросы
  * сервер берет на себя роль resolver'а
  * можно настроить сервер так, чтобы он не обслуживал внешних клиентов
* Итерационные запросы
  * сервер не делает рекурсивный обход, а возвращает ссылку на товарища, который обладает более подробной информацией

### Транспорт для DNS

* адресное общение (unicast)
* дейтаграммный (UDP) и потоковый (TCP) режимы передачи
  * UDP: порт сервера - 53, ограничения: в IPv4 - 512 байт, в IPv6 - 1240 байт. Это стандартный режим работы
  * TCP: границы сообщения - 64К

### Формат ресурсной записи (RR)

1) NAME - домен владельца RR
2) Type
3) Class - семейство протоколов (почти всегда - ip)
4) TTL - время жизни RR в кэше клиента
5) RDLENGTH - размер поля данных RR
6) RDATA - само поле с данными

### Типы RR

* А - адрес хоста (в данных - ip-адрес)
* NS - авторитетный Name Server (в данных - имя хоста (не адрес!))
* CNAME - псевдоним (в данных - доменное имя)
* SOA - метка начала зоны ответственности. Поля:
  * MNAME - имя основного сервера
  * RNAME - адрес почтового ящика человека, ответственного за зону
  * SERIAL - число, определяющее номер копии зоны. Можем понять, были ли какие-то изменения в зоне и надо ли их запрашивать. При изменении зоны инкрементируется
  * REFRESH - время, через которое надо обновить зону
  * RETRY - минимальное время перед повторной попыткой обновить информацию о зоне после неудачной попытки
  * EXPIRE - верхняя граница времени, после которого считаем информацию недействительной
  * MINIMUM - минимальный TTL, который экспортируется с RR из данной зоны
* PTR - указатель на доменное имя, а-ля обратное преобразование (в данных - доменное имя)
* MX - точка обмена электронными сообщениями
* TXT - текстовая строка
* SRV - поиск сервиса в сети

### Формат сообщения DNS-протокола

* Header
* Question - запрос к главному серверу
* Answer - RR с ответом
* Authrity - RR, указывающая на авторитетный сервер, отвечаем за зону
* Additional - доп. информация от сервера
