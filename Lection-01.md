# Лекция 1

## Cодержание
* [Общие замечания](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-01.md#общие-замечания)
* [Утилита `ping`](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-01.md#работа-утилиты-ping)
* [Классификация сетей](https://github.com/AliakseiSuvorau/networks/blob/master/Lection-01.md#классификация-сетей-по-типу-адресации)

### Общие замечания
* Сетевой уровень
  * ip-адреса
  * icmp-протоколы

* Канальный уровень:
  * mac-адреса (захардкожены производителем устройства, занимают 48 бит, разделены на 6 октет)
  * Коммутатор знает, на каком порте сидит какое устройство (есть таблица соответствия порт-адрес, она называется *таблицей коммутации*)
  * ARP-протокол (Address resolution protocol) позволяет с помощью *ARP-таблицы* получить по ip-адресу устройства его mac-адрес. ARP-таблица находится на каждом хосте.
    Если в ARP-таблице нужного адреса нет, то устройство посылает широковещательное сообшение всем другим устройствам, каждое из них сравнивает этот ip-адрес со своим, и при совпадении шлет в ответ свой mac-адрес.
  
> [!NOTE]
> Если коммутатор не находит нужного адреса в таблице, то посылает запрос на все адреса

> [!NOTE]
> Порт на физическом уровне - буквально отверстие в устройстве для подключения кабеля

* DNS-сервер (Domain Name Server):
  * Выдает ip-адрес по доменному имени сети
  * Сервис прикладного уровня
  * Адреса DNS-серверов захардкожены в устройства

### Работа утилиты `ping`

Что происходит, когда мы пишем в командной строке `ping ya.ru`?

1. Так как мы подали утилите доменное имя, то для начала надо получить ip-адрес устройства, к которому хотим послать пакет.
   Для этого существует DNS-сервер. Для упрощения будем считать, что он находится в нашей локальной сети. Общение устройств в локальной сети происходит посредством mac-адресов.
   Поэтому прежде всего нам надо получить mac-адрес DNS-сервера. После этого mac-адрес DNS-сервера сохранится в ARP-кэш.
   > Пакет 1: ARP-запрос от хоста 1 к DNS
   
   > Пакет 2: ARP-ответ от DNS хосту 1 со своим mac-адресом

2. Формируем DNS-запрос (в Ethrnet, на канальном уровне).
   > Пакет 3: DNS-запрос от хоста 1 к DNS об ip-адресе хоста 2

3. Прежде чем ответить на запрос, DNS должен убедиться, что соединение безопасно. Для этого он отправляет обратно ARP-запрос к хосту 1.
   > Пакет 4: ARP-запрос от DNS к хосту 1 о его mac-адресе
   
   > Пакет 5: Ответ хоста 1

> [!NOTE]
> Этот шаг может быть пропущен
4. Ответ от DNS хосту 1. Полученный адрес попадет в DNS-кэш хоста 1.
   > Пакет 6: Овет от DNS-сервера хосту 1 об ip-адресе хоста 2

5. Хост 1 посылает ARP-запрос с целью узнать mac-адрес хоста 2 по его ip-адресу.
   > Пакет 7: ARP-запрос от хоста 1 к хосту 2
   
   > Пакет 8: ARP-ответ от хоста 2 хосту 1

6. Наконец, мы посылаем наш icmp-пакет с запросом от хоста 1 к хосту 2.
   > Пакет 9: icmp-запрос от хоста 1 к хосту 2

7. Возможно, повторится ситуация, описанная в п.3.
   > Пакет 10: ARP-запрос от хоста 2 к хосту 1
   
   > Пакет 11:  ARP-ответ от хоста 1 хосту 2

8. Теперь хост 2 может отправить ответ на запрос хоста 1.
   > Пакет 12: icmp-ответ от хоста 2 хосту 1

### Классификация сетей по типу адресации

* Unicast - одно устройство обращается к конкретному другому
* Broadcast - одно устройство обращается ко всем устройствам в **локальной** сети
* Multicast - одно устройство обращается к некоторой группе устройств в **локальной** сети
* Anycast -  как Multicast, только достаточно доставить пакет любому (одному) устройству из группы

### Классификация сетей по идентификаторам

* Числовые идентификаторы (mac, IPv4) - удобно для устройств
* Символьные идентификаторы (доменные имена) - удобно для людей
